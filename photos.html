<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>相册</title>
<style>
  body { margin:0; font-family:"Helvetica", sans-serif; background:#fff; color:#000; }
  header, footer { text-align:center; padding:1rem; background:#f0f0f0; }
  nav a { margin:0 15px; text-decoration:none; font-weight:bold; color:#000; }
  nav a:hover { text-decoration:underline; }
  .container { max-width:1000px; margin:auto; padding:20px; }
  .photo-wrapper { display:flex; justify-content:center; gap:40px; margin-top:20px; }
  .photo-wrapper img { max-width:300px; border:2px solid #ccc; box-shadow:2px 2px 6px rgba(0,0,0,0.2);}
  .canvas-container { border:2px solid #ccc; box-shadow:2px 2px 6px rgba(0,0,0,0.2); display:inline-block;}
  canvas { display:block; }
  #markdown-content { margin-top:40px; padding:20px; border:1px solid #ccc; background:#fafafa; line-height:1.6;}
  #markdown-content h1, #markdown-content h2, #markdown-content h3 { color:#333; }
  #markdown-content a { color:#1a0dab; text-decoration:underline; }
</style>
</head>
<body>

<header>
  <h1>相册</h1>
  <nav>
    <a href="index.html">首页</a>
    <a href="about.html">关于我</a>
    <a href="photos.html">相册</a>
  </nav>
</header>

<div class="container">
  <h2>我的照片</h2>
  <p>左边是原始照片，右边是粒子化互动效果。</p>

  <div class="photo-wrapper">
    <img id="original-photo" src="photos/myphoto.jpg" alt="我的照片">
    <div class="canvas-container">
      <canvas id="canvas"></canvas>
    </div>
  </div>

  <h2>2024 学生 IT 手册</h2>
  <div id="markdown-content"></div>
</div>

<footer>
  <p>© 2025 我的个人博客</p>
</footer>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const mouse = { x:null, y:null, radius:80 };
canvas.addEventListener('mousemove', e => {
  const rect = canvas.getBoundingClientRect();
  mouse.x = e.clientX - rect.left;
  mouse.y = e.clientY - rect.top;
});

class Particle{
  constructor(x,y,color){
    this.x=x; this.y=y; this.baseX=x; this.baseY=y;
    this.size=2; this.color=color; this.density=Math.random()*30+1;
  }
  draw(){ ctx.fillStyle=this.color; ctx.beginPath(); ctx.arc(this.x,this.y,this.size,0,Math.PI*2); ctx.fill(); }
  update(){
    let dx=mouse.x-this.x, dy=mouse.y-this.y, distance=Math.sqrt(dx*dx+dy*dy);
    if(distance<mouse.radius){
      let force=(mouse.radius-distance)/mouse.radius;
      this.x-=(dx/distance)*force*this.density;
      this.y-=(dy/distance)*force*this.density;
    }else{ this.x+=(this.baseX-this.x)*0.05; this.y+=(this.baseY-this.y)*0.05; }
  }
}

let particlesArray=[];
function init(imgWidth,imgHeight){
  canvas.width=imgWidth; canvas.height=imgHeight; particlesArray=[];
  const img=new Image(); img.src='photos/myphoto.jpg';
  img.onload=()=>{
    const tempCanvas=document.createElement('canvas');
    const tempCtx=tempCanvas.getContext('2d');
    tempCanvas.width=imgWidth; tempCanvas.height=imgHeight;
    tempCtx.drawImage(img,0,0,imgWidth,imgHeight);
    const imgData=tempCtx.getImageData(0,0,imgWidth,imgHeight);
    for(let y=0;y<imgData.height;y+=4){
      for(let x=0;x<imgData.width;x+=4){
        const idx=(y*imgData.width+x)*4;
        const r=imgData.data[idx], g=imgData.data[idx+1], b=imgData.data[idx+2], a=imgData.data[idx+3];
        if(a>128){ particlesArray.push(new Particle(x,y,`rgb(${r},${g},${b})`)); }
      }
    }
    animate();
  }
}

function animate(){ ctx.clearRect(0,0,canvas.width,canvas.height); particlesArray.forEach(p=>{p.update();p.draw();}); requestAnimationFrame(animate); }

const originalImg=document.getElementById('original-photo');
originalImg.onload=()=>{ init(originalImg.width,originalImg.height); };
</script>

<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script>
fetch('content/2024_student_IT_guide.md')
  .then(res=>res.text())
  .then(text=>{ document.getElementById('markdown-content').innerHTML=marked.parse(text); });
</script>

</body>
</html>
